// ðŸ”¥ AgriNest Firestore Security Rules
// Copy this to your Firebase Console â†’ Firestore â†’ Rules

rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    // Users can only access their own profile data
    match /users/{userId} {
      allow read, write: if request.auth != null
                         && request.auth.uid == userId;
    }

    // Phone number index - public read for checking availability, authenticated write for reserving
    match /phoneNumbersIndex/{phoneNumber} {
      // Allow anyone to check if phone is taken (unauthenticated read)
      allow read: if true;

      // Only authenticated users can reserve phone numbers
      allow create: if request.auth != null;

      // Authenticated users can update their own reservations
      allow update: if request.auth != null;

      // Authenticated users can delete reservations
      allow delete: if request.auth != null;
    }

    // TODO: Add rules for sensor data collections when implemented
    // match /sensorData/{document=**} {
    //   allow read, write: if request.auth != null;
    // }
  }
}

// ðŸ“‹ How to apply these rules:
// 1. Go to Firebase Console
// 2. Select your project
// 3. Go to Firestore Database
// 4. Click on "Rules" tab
// 5. Replace the existing rules with the above code
// 6. Click "Publish"

// ðŸ”’ Security Benefits:
// - Users can only read/write their own profile data
// - No unauthorized access to other users' data
// - Authenticated users only (request.auth != null)
// - UID-based access control (request.auth.uid == userId)
